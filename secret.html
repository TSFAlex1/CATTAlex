<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Secret — CATTAlex</title>
  <meta name="description" content="Secret link — CATTAlex" />
  <link rel="icon" href="CATTAlex pic2.png" type="image/png">
  <meta name="theme-color" content="#071022">

  <!-- Reuse the site's main stylesheet -->
  <link rel="stylesheet" href="styles.css">

  <!-- Modal-specific styles (keeps everything self-contained and compatible with styles.css) -->
  <style>
    /* Full-screen blurred backdrop (while passcode modal active) */
    .secret-backdrop {
      position:fixed;
      inset:0;
      z-index:120;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(4,6,10,0.35);
      -webkit-backdrop-filter: blur(6px) saturate(1.1);
      backdrop-filter: blur(6px) saturate(1.1);
      pointer-events:auto;
    }

    .secret-modal {
      width: min(520px, 92%);
      background: linear-gradient(180deg, rgba(8,12,20,0.98), rgba(11,15,24,0.95));
      border: 1px solid rgba(255,255,255,0.06);
      padding: 22px;
      border-radius: 14px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.6);
      color: #e9f1ff;
      z-index:121;
    }

    .secret-modal h3 { margin:0 0 12px 0; font-family:Orbitron, Inter, sans-serif; color:var(--blue) }
    .secret-modal p { margin:8px 0; color:var(--muted) }

    .code-input {
      width:100%;
      display:flex;
      gap:8px;
      margin-top:12px;
    }
    .code-input input[type="text"]{
      flex:1;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.06);
      background: rgba(255,255,255,0.02);
      color: #fff;
      font-size:16px;
      letter-spacing:2px;
      text-align:center;
    }
    .code-input button{
      padding:10px 14px;
      border-radius:8px;
      border:0;
      cursor:pointer;
      font-weight:700;
      background: linear-gradient(90deg,var(--red),var(--blue));
      color:#071022;
    }

    .secret-small {
      font-size:13px;color:var(--muted);margin-top:8px;
    }

    /* Disabled modal state (during lockout): dim button and input */
    .secret-modal.locked { opacity:0.9 }
    .secret-modal.locked input,
    .secret-modal.locked button { opacity:0.6; pointer-events:none }

    /* Simple non-blurred popup (for the bottom "reveal" button and warning) */
    .plain-popup, .warning-popup {
      position:fixed;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      z-index:130;
      min-width:260px;
      max-width:90%;
      background: linear-gradient(180deg, rgba(10,14,22,0.99), rgba(8,12,20,0.95));
      border: 1px solid rgba(255,255,255,0.06);
      padding:18px;
      border-radius:12px;
      box-shadow: 0 18px 50px rgba(0,0,0,0.6);
      color:#e9f1ff;
    }
    .plain-popup button, .warning-popup button{ margin-top:12px }

    /* Prevent pointer events on the page while passcode backdrop is active */
    body.secret-locked *:not(.secret-backdrop):not(.secret-backdrop *):not(.plain-popup):not(.warning-popup) {
      pointer-events: none;
      user-select: none;
    }

    /* Focus outline for accessibility */
    .secret-modal :focus { outline: 2px solid rgba(74,211,255,0.14); outline-offset:3px; }

    /* Warning popup specifics */
    .warning-title { font-size:16px; font-weight:700; color:var(--red); margin:0 0 8px 0; }
    .warning-body { color:var(--muted); margin-bottom:12px; white-space:pre-wrap; }

    /* Position reveal button */
    .reveal-ctl { position:fixed; left:18px; bottom:18px; z-index:90; }
  </style>
</head>
<body>
  <!-- Reuse background and decorative layers for consistent look -->
  <div class="bg-image" id="bgImage" aria-hidden="true"></div>
  <div class="scene-bg" aria-hidden="true">
    <div class="bg-layer layer--1"></div>
    <div class="bg-layer layer--2"></div>
    <div class="bg-layer layer--3"></div>
  </div>

  <header class="site-header">
    <div class="header-inner">
      <div class="brand">
        <div class="avatar-wrap" aria-hidden="false">
          <img src="CATTAlex pic.jpg" alt="CATTAlex profile" class="avatar" id="avatar">
          <div class="neon-ring" aria-hidden="true"></div>
        </div>
        <div class="brand-text">
          <h1 class="channel-title">CATTAlex</h1>
          <p class="subtitle">Secret</p>
        </div>
      </div>

      <nav class="top-cta" aria-label="Primary">
        <a class="btn btn--glass" href="index.html">Back to Home</a>
      </nav>
    </div>
  </header>

  <main class="page" id="page" aria-hidden="false">
    <section class="panel panel--info" id="secret-panel">
      <div class="panel-inner">
        <h2>Secret Folder</h2>
        <p>Access the secret drive folder here:</p>
        <p>
          <!-- Clicking this triggers the warning popup first (if unlocked) -->
          <a class="btn btn--accent" id="secretLink" href="https://drive.google.com/drive/folders/1bb12p4kHvWDdIgvz047X4fAa9DKskguX?usp=sharing" target="_blank" rel="noopener noreferrer">Open Secret Drive Folder</a>
        </p>

        <div style="margin-top:18px;">
          <a class="btn btn--ghost" href="index.html">Back to Home</a>
        </div>
      </div>
    </section>
  </main>

  <!-- Blurred full-screen passcode modal (shown on page load unless unlocked) -->
  <div id="secretBackdrop" class="secret-backdrop" style="display:none;" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="secretTitle">
    <div id="secretModal" class="secret-modal" role="document">
      <h3 id="secretTitle">Enter 4‑digit passcode</h3>
      <p class="secret-small">This area is restricted. Enter the correct 4-digit code to reveal the content.</p>

      <div class="code-input" role="group" aria-label="Passcode input">
        <input id="passInput" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="4" autocomplete="off" aria-label="4 digit passcode" />
        <button id="passSubmit" type="button">Enter</button>
      </div>

      <div id="statusText" class="secret-small" aria-live="polite"></div>
    </div>
  </div>

  <!-- Non-blurred plain popup that displays the secret (reveal button) -->
  <div id="plainPopup" class="plain-popup" style="display:none;" role="dialog" aria-modal="false" aria-labelledby="plainTitle">
    <h4 id="plainTitle">Secret Code</h4>
    <p id="plainContent" style="font-weight:700; font-size:18px; letter-spacing:2px; margin-top:6px;"></p>
    <div style="text-align:right">
      <button id="plainClose" class="btn btn--glass">Close</button>
    </div>
  </div>

  <!-- Warning popup shown when user clicks Open Secret Drive Folder (no blur) -->
  <div id="warningPopup" class="warning-popup" style="display:none;" role="dialog" aria-modal="false" aria-labelledby="warningTitle">
    <div>
      <div class="warning-title" id="warningTitle">Warning — Naluluna mods</div>
      <div class="warning-body">This folder contains Naluluna mods which are usually paid content. By continuing you acknowledge that these are third‑party mods and you use them at your own risk. Respect authors and consider supporting them.</div>
      <div style="display:flex;gap:10px;justify-content:flex-end;">
        <button id="warningCancel" class="btn btn--ghost">Cancel</button>
        <button id="warningOpen" class="btn btn--accent">Open Folder</button>
      </div>
    </div>
  </div>

  <!-- Reveal button (bottom-left of the page) -->
  <div class="reveal-ctl">
    <button id="revealBtn" class="btn btn--ghost">Reveal Code (popup)</button>
  </div>

  <script>
    (function(){
      // --- Simple XOR obfuscation for the secret "6381" ---
      // Note: obfuscation only; not a secure secret storage.
      const xorKey = 123; // single-byte XOR key
      const encryptedBytes = [77, 72, 67, 74]; // each = charCode ^ xorKey for "6381"
      function decryptSecret(){ return String.fromCharCode(...encryptedBytes.map(b => b ^ xorKey)); }

      // UI elements
      const backdrop = document.getElementById('secretBackdrop');
      const modal = document.getElementById('secretModal');
      const passInput = document.getElementById('passInput');
      const passSubmit = document.getElementById('passSubmit');
      const statusText = document.getElementById('statusText');
      const revealBtn = document.getElementById('revealBtn');
      const plainPopup = document.getElementById('plainPopup');
      const plainContent = document.getElementById('plainContent');
      const plainClose = document.getElementById('plainClose');
      const secretLink = document.getElementById('secretLink');
      const warningPopup = document.getElementById('warningPopup');
      const warningCancel = document.getElementById('warningCancel');
      const warningOpen = document.getElementById('warningOpen');

      // Lockout & attempts (localStorage)
      const LS_FAILED = 'secret_failed_attempts';
      const LS_LOCKUNTIL = 'secret_lock_until';
      const LOCK_THRESHOLD = 10;
      const LOCK_DURATION_MS = 2 * 60 * 1000; // 2 minutes

      function getFailedAttempts(){ return parseInt(localStorage.getItem(LS_FAILED) || '0',10); }
      function setFailedAttempts(n){ localStorage.setItem(LS_FAILED, String(n)); }
      function clearFailedAttempts(){ localStorage.removeItem(LS_FAILED); }

      function setLockUntil(ts){ localStorage.setItem(LS_LOCKUNTIL, String(ts)); }
      function getLockUntil(){ return parseInt(localStorage.getItem(LS_LOCKUNTIL) || '0',10); }
      function clearLockUntil(){ localStorage.removeItem(LS_LOCKUNTIL); }

      function isLockedNow(){
        const until = getLockUntil();
        return until && (Date.now() < until);
      }

      // Session unlock flag
      const SESSION_UNLOCKED = 'secret_unlocked_session';
      function markUnlocked(){ sessionStorage.setItem(SESSION_UNLOCKED, '1'); clearFailedAttempts(); clearLockUntil(); }
      function isSessionUnlocked(){ return sessionStorage.getItem(SESSION_UNLOCKED) === '1'; }

      // Modal show/hide
      function showModalDisabled(message){
        backdrop.style.display = 'flex';
        backdrop.setAttribute('aria-hidden','false');
        modal.classList.add('locked');
        document.body.classList.add('secret-locked');
        statusText.textContent = message || '';
        passInput.value = '';
      }
      function showModal(message){
        backdrop.style.display = 'flex';
        backdrop.setAttribute('aria-hidden','false');
        modal.classList.remove('locked');
        document.body.classList.add('secret-locked');
        statusText.textContent = message || '';
        passInput.value = '';
        passInput.focus();
      }
      function hideModal(){
        backdrop.style.display = 'none';
        backdrop.setAttribute('aria-hidden','true');
        document.body.classList.remove('secret-locked');
        statusText.textContent = '';
      }

      // Wrong attempt handling
      function recordWrongAttempt(){
        let n = getFailedAttempts();
        n += 1;
        setFailedAttempts(n);
        if (n >= LOCK_THRESHOLD){
          const until = Date.now() + LOCK_DURATION_MS;
          setLockUntil(until);
          // redirect to index.html immediately
          window.location.href = 'index.html';
        } else {
          statusText.textContent = `Incorrect code — ${LOCK_THRESHOLD - n} attempts remaining.`;
        }
      }

      // Lock countdown
      let countdownTimer = null;
      function startLockCountdown(){
        const until = getLockUntil();
        if (!until || Date.now() >= until) {
          clearLockUntil();
          clearFailedAttempts();
          return showModal();
        }
        showModalDisabled('');
        function tick(){
          const now = Date.now();
          const rem = until - now;
          if (rem <= 0){
            clearLockUntil();
            clearFailedAttempts();
            clearInterval(countdownTimer);
            countdownTimer = null;
            showModal();
            return;
          }
          const s = Math.ceil(rem / 1000);
          statusText.textContent = `Too many incorrect attempts. Try again in ${s} second${s===1?'':'s'}.`;
        }
        tick();
        countdownTimer = setInterval(tick, 1000);
      }

      // Submit handler
      passSubmit.addEventListener('click', function(){
        const val = (passInput.value || '').trim();
        if (!/^\d{4}$/.test(val)){
          statusText.textContent = 'Enter a 4-digit numeric code.';
          return;
        }
        const secret = decryptSecret();
        if (val === secret){
          markUnlocked();
          hideModal();
        } else {
          recordWrongAttempt();
          passInput.value = '';
          passInput.focus();
        }
      });

      // Enter key handler
      passInput.addEventListener('keydown', function(e){
        if (e.key === 'Enter'){
          e.preventDefault();
          passSubmit.click();
        }
        if (e.key === 'Tab'){ // keep focus trapped
          e.preventDefault();
        }
      });

      // Prevent clicking outside to escape
      backdrop.addEventListener('click', function(e){
        if (!modal.contains(e.target)){
          e.stopPropagation();
          passInput.focus();
        }
      });

      // Trap focus while modal active
      window.addEventListener('focus', function(){
        if (backdrop.style.display === 'flex' && !isSessionUnlocked()){
          passInput.focus();
        }
      }, true);

      // Plain popup reveal button - decrypt and show (no blur)
      revealBtn.addEventListener('click', function(){
        try{
          const code = decryptSecret();
          plainContent.textContent = code;
          plainPopup.style.display = 'block';
          plainClose.focus();
        }catch(e){
          plainContent.textContent = 'Error';
          plainPopup.style.display = 'block';
        }
      });
      plainClose.addEventListener('click', function(){
        plainPopup.style.display = 'none';
      });

      // SECRET LINK behavior:
      // - If not unlocked: prevent navigation and prompt for passcode (existing behavior)
      // - If unlocked: show a warning popup (no blur). "Open Folder" opens the link in a new tab.
      secretLink.addEventListener('click', function(e){
        if (!isSessionUnlocked()){
          e.preventDefault();
          passInput.focus();
          statusText.textContent = 'Enter the passcode to access this link.';
          // show passcode modal if hidden
          if (!isLockedNow()) showModal();
        } else {
          e.preventDefault(); // prevent immediate navigation; show warning first
          // show warning popup
          warningPopup.style.display = 'block';
          // focus Cancel for accessibility
          warningCancel.focus();
        }
      });

      // Warning popup handlers
      warningCancel.addEventListener('click', function(){
        warningPopup.style.display = 'none';
      });
      warningOpen.addEventListener('click', function(){
        // open the folder URL in a new tab
        const url = secretLink.href;
        window.open(url, '_blank', 'noopener');
        warningPopup.style.display = 'none';
      });

      // On load: show passcode modal unless unlocked, or show lock countdown if locked
      window.addEventListener('load', function(){
        if (isSessionUnlocked()){
          hideModal();
          return;
        }
        if (isLockedNow()){
          startLockCountdown();
        } else {
          showModal();
        }

        // Prevent scrolling while modal present
        document.addEventListener('touchmove', function(e){
          if (document.body.classList.contains('secret-locked')) e.preventDefault();
        }, { passive:false });
      });

      // Clean up on unload
      window.addEventListener('beforeunload', function(){
        if (countdownTimer) clearInterval(countdownTimer);
      });
    })();
  </script>
</body>
</html>
